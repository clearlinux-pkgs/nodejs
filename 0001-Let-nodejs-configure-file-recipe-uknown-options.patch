From 295ea016f4f46472b202e604ff32403033a131fc Mon Sep 17 00:00:00 2001
From: Josue David Hernandez Gutierrez <josue.d.hernandez.gutierrez@intel.com>
Date: Mon, 21 Aug 2017 15:11:38 -0500
Subject: [PATCH] Let nodejs configure file recipe uknown options

Clearlinux is passing uknown options to configure nodejs, let's not
deal with this.

Signed-off-by: Bruno Bottazzini <bruno.bottazzini@intel.com>
Signed-off-by: Josue David Hernandez Gutierrez <josue.d.hernandez.gutierrez@intel.com>
---
 configure         | 23 +++++++++++++++++++++--
 tools/gyp_node.py |  5 +++--
 2 files changed, 24 insertions(+), 4 deletions(-)

diff --git a/configure b/configure
index 0b9c3a1..0fc1dc2 100755
--- a/configure
+++ b/configure
@@ -42,8 +42,27 @@ sys.path.insert(0, os.path.join(root_dir, 'tools'))
 import getmoduleversion
 from gyp_node import run_gyp
 
+from optparse import (OptionParser,BadOptionError,AmbiguousOptionError)
+class OptionParserIgnoreUknownOptions(OptionParser):
+    def _process_args(self, largs, rargs, values):
+        ag = largs
+        val = values
+        while rargs:
+            try:
+                OptionParser._process_args(self,largs,rargs,values)
+                ag = largs
+            except (BadOptionError,AmbiguousOptionError), e:
+                largs.append(e.opt_str)
+        OptionParser._process_args(self, ag, ['--without-snapshot'], values)
+        ag.append("--without-snapshot")
+        OptionParser._process_args(self, ag, ['--dest-cpu=x64'], values)
+        ag.append("--dest-cpu=x64")
+        OptionParser._process_args(self, ag, ['--dest-os=linux'], values)
+        ag.append("--dest-os=linux")
+
+
 # parse our options
-parser = optparse.OptionParser()
+parser = OptionParserIgnoreUknownOptions()
 
 valid_os = ('win', 'mac', 'solaris', 'freebsd', 'openbsd', 'linux',
             'android', 'aix')
@@ -1436,4 +1455,4 @@ gyp_args += args
 if warn.warned:
   warn('warnings were emitted in the configure phase')
 
-run_gyp(gyp_args)
+run_gyp()
diff --git a/tools/gyp_node.py b/tools/gyp_node.py
index 043053c..a6b6cf0 100755
--- a/tools/gyp_node.py
+++ b/tools/gyp_node.py
@@ -12,7 +12,8 @@ import gyp
 # to be written.
 output_dir = os.path.join(os.path.abspath(node_root), 'out')
 
-def run_gyp(args):
+def run_gyp():
+  args = []
   # GYP bug.
   # On msvs it will crash if it gets an absolute path.
   # On Mac/make it will crash if it doesn't get an absolute path.
@@ -57,4 +58,4 @@ def run_gyp(args):
 
 
 if __name__ == '__main__':
-  run_gyp(sys.argv[1:])
+  run_gyp()
-- 
2.4.11

