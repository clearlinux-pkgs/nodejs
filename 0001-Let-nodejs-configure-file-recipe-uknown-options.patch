From b6898a44b63de5317e317f559d36df248e2de212 Mon Sep 17 00:00:00 2001
From: Bruno Bottazzini <bruno.bottazzini@intel.com>
Date: Thu, 22 Oct 2015 15:58:43 -0200
Subject: [PATCH] Let nodejs configure file recipe uknown options

Clearlinux is passing uknown options to configure nodejs, let's not
deal with this.

Signed-off-by: Bruno Bottazzini <bruno.bottazzini@intel.com>
---
 configure         | 21 ++++++++++++++++++++-
 tools/gyp_node.py |  3 ++-
 2 files changed, 22 insertions(+), 2 deletions(-)

diff --git a/configure b/configure
index 66cb312..427c3bf 100755
--- a/configure
+++ b/configure
@@ -19,8 +19,27 @@ from gyp.common import GetFlavor
 sys.path.insert(0, os.path.join(root_dir, 'tools', 'configure.d'))
 import nodedownload
 
+from optparse import (OptionParser,BadOptionError,AmbiguousOptionError)
+class OptionParserIgnoreUknownOptions(OptionParser):
+    def _process_args(self, largs, rargs, values):
+        ag = largs
+        val = values
+        while rargs:
+            try:
+                OptionParser._process_args(self,largs,rargs,values)
+                ag = largs
+            except (BadOptionError,AmbiguousOptionError), e:
+                largs.append(e.opt_str)
+        OptionParser._process_args(self, ag, ['--without-snapshot'], values)
+        ag.append("--without-snapshot")
+        OptionParser._process_args(self, ag, ['--dest-cpu=x64'], values)
+        ag.append("--dest-cpu=x64")
+        OptionParser._process_args(self, ag, ['--dest-os=linux'], values)
+        ag.append("--dest-os=linux")
+
+
 # parse our options
-parser = optparse.OptionParser()
+parser = OptionParserIgnoreUknownOptions()
 
 # Options should be in alphabetical order but keep --prefix at the top,
 # that's arguably the one people will be looking for most.
diff --git a/tools/gyp_node.py b/tools/gyp_node.py
index 7b49505..afd6739 100755
--- a/tools/gyp_node.py
+++ b/tools/gyp_node.py
@@ -21,7 +21,8 @@ def run_gyp(args):
     sys.exit(rc)
 
 if __name__ == '__main__':
-  args = sys.argv[1:]
+  #args = sys.argv[1:]
+  args = []
 
   # GYP bug.
   # On msvs it will crash if it gets an absolute path.
-- 
2.6.1

